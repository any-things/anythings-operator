<!--
@license
Copyright © HatioLab Inc. All rights reserved.
-->

<link rel="import" href="../../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../../tablet-libraries.html">

<!--
  공통 > 박스 할당 화면
-->
<dom-module id="mps-box-inspect-mpi-on-off">
  <template>
    <style include="shared-styles">
    </style>

    <!-- 태블릿 작업 존의 처리 안된 혹은 처리 완료된 작업을 조회하여 표시기에 점등 -->
    <sys-ajax
      id="mpi-on-jobs-ajax"
      method="PUT"
      curl="/tablet_process/mpi_on/:region_cd/:zone_cd/:side_cd"
      content-type="application/json">
    </sys-ajax>

    <!-- 표시기 소등 -->
    <sys-ajax
      id="mpi-off-my-zone-ajax"
      method="PUT"
      curl="/tablet_process/mpi_off/:region_cd/:zone_cd/:side_cd"
      content-type="application/json">
    </sys-ajax>

    <!-- 상품 검수 트랜잭션을 위한 Ajax -->
    <sys-ajax
      id="inspect-sku-ajax"
      method="POST"
      content-type="application/json"
      last-response="{{inspectResult}}">
    </sys-ajax>
  </template>

  <script>
    class MpsBoxInspectMpiOnOff extends Polymer.Element {
      static get is() { return 'mps-box-inspect-mpi-on-off' }

      static get properties() {
        return {
          isOnTodo: {
            type: Boolean,
            observer: '_isOnTodoChanged'
          },

          isOnDone: {
            type: Boolean,
            observer: '_isOnDoneChanged'
          },

          isInspectMode: {
            type: Boolean,
            observer: '_isInspectModeChanged'
          },

          comCode: {
            type: String
          },

          skuCode: {
            type: String,
            observer: '_skuCodeChanged'
          }
        }
      }

      _isOnTodoChanged(isOnTodo) {
        if (isOnTodo) {
          this._mpiOnByTabletZone('todo');
        } else {
          this._mpiOffByTabletZone();
        }
      }

      _skuCodeChanged(skuCode) {
        if (!skuCode) {
          return;
        }

        if (!this.isInspectMode) {
          return;
        }

        let regionCode = ANY_UTIL.getRegionCd();
        let sideCode = ANY_UTIL.getSideCd();
        let zoneCode = ANY_UTIL.getZoneCd();
        let inspectAjax = this.$['inspect-sku-ajax'];
        inspectAjax.curl = `/pda_process/inspection_by_mpi/${regionCode}/${sideCode}/${zoneCd}/${this.comCode}/${skuCode}`;
        inspectAjax.generateRequest();

        this.skuCode = null;
      }

      _isInspectModeChanged(isInspectMode) {
        if (!isInspectMode) {
          this._mpiOffByTabletZone();
        }
      }

      /**
       * @description 태블릿 작업 존에 해당하는 표시기 리스트를 소등한다.
       */
      _mpiOffByTabletZone() {
        const mpiOffAjax = this.$['mpi-off-my-zone-ajax'];
        let regionCd = ANY_UTIL.getRegionCd();
        let zoneCd = ANY_UTIL.getZoneCd();
        let sideCd = ANY_UTIL.getSideCd();
        mpiOffAjax.curl = `/tablet_process/mpi_off/${regionCd}/${zoneCd}/${sideCd}`;
        mpiOffAjax.generateRequest();
      }

      /**
       * @description mode에 따라 태블릿의 작업 존에 현재 선택된 버킷 (즉 주문) 중에 처리 안 된 혹은 처리 완료된 작업 리스트에 대한 표시기 점등
       **************************
       * @param {String} mode
       */
      _mpiOnByTabletZone(mode) {
        const mpiOnAjax = this.$['mpi-on-jobs-ajax'];
        let regionCd = ANY_UTIL.getRegionCd();
        let zoneCd = ANY_UTIL.getZoneCd();
        let sideCd = ANY_UTIL.getSideCd();
        mpiOnAjax.curl = `/tablet_process/mpi_on/${regionCd}/${zoneCd}/${sideCd}`;
        mpiOnAjax.generateRequest();
      }
    }

    customElements.define(MpsBoxInspectMpiOnOff.is, MpsBoxInspectMpiOnOff);
  </script>
</dom-module>
