<!--
@license
Copyright © HatioLab Inc. All rights reserved.
-->

<link rel="import" href="../../../../../bower_components/polymer/polymer-element.html">

<!--
  물류 > B2C > 박스 투입 화면 (KIOSK)
-->
<dom-module id="b2c-box-input">
  <template>
    <style>
      #container {
        display: flex;
        flex-direction: column;
        height: calc(100% - 40px);
        padding: 20px 25px;
      }

      .chart-section {
        background-color: #5A6377;
        border-radius: var(--things-default-border-radius);
        padding: 10px;
        color: #fff;
      }

      .chart-row {
        display: grid;
        grid-template-columns: 1fr 15% 15%;
        font-size: .8rem;
        margin-bottom: 10px;
      }

      .chart-row .col-header {
        text-align: right;
        margin-right: 10px;
      }

      .chart-row .bar-chart {
        display: flex;
        flex-direction: row;
        margin-top: 0.7em;
      }

      .chart-row .bar-chart .label {
        width: 5vw;
        font-size: .8rem;
        margin: auto 10px auto auto;
      }

      .chart-row .bar-chart .bar {
        display: inline-block;
        flex: 1;
        background-color: rgba(0, 0, 0, .2);
        border-radius: var(--things-default-border-radius);
      }

      .chart-row .bar-chart .chart-value {
        display: inline-block;
        border-radius: var(--things-default-border-radius);
        margin: 5px;
        text-align: right;
      }

      .chart-row .bar-chart #order-bar {
        background-color: #3cde4b;
      }

      .chart-row .bar-chart #sku-bar {
        background-color: #25b2e6
      }

      .chart-row .bar-chart #pcs-bar {
        background-color: #01c9c6
      }

      .chart-row .num-data {
        text-align: right;
        margin: auto 0;
      }

      #top-container {
        display: grid;
        grid-template-columns: 2.8fr 1fr;
        grid-gap: 20px;
        margin-bottom: 20px;
      }

      #middle-container {
        display: grid;
        background-color: var(--things-white-opacity-background-color);
        grid-auto-flow: column;
        grid-gap: 10px;
        padding: 9px;
        border-radius: var(--things-default-border-radius);
        margin-bottom: 20px;
      }

      #label {
        text-align: right;
        color: rgba(255, 255, 255, .7);
        font-size: 1rem;
        margin-top: auto;
        margin-bottom: auto;
      }

      #label *,
      #refresh-btn * {
        vertical-align: middle
      }

      .input-container {
        display: grid;
        grid-template-columns: auto auto;
        grid-column-gap: 10px;
      }

      button {
        @apply --operator-default-btn;
      }

      button:active {
        @apply --operator-default-btn-active;
      }

      button:focus {
        outline: none
      }

      input {
        background-color: rgba(0, 0, 0, .25);
        border: 1px solid rgba(255, 255, 255, .2);
        height: 54px;
        color: #fff;
        font-size: 1.3rem;
        text-align: center;
        margin: auto;
      }

      input:focus {
        outline: none;
      }

      .table {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        font-size: 15pt;
        text-align: center;
      }

      .summary-header {
        color: #585858;
        background: #e6b84b;
        padding: 7px 5px 5px 5px;
        border-radius: 5px;
        margin-bottom: 9px;
      }

      .content-container {
        background-color: #3C414B;
        padding: 5px;
        border-radius: 5px;
      }

      .summary-content {
        color: #CCCCCE;
        border-bottom: 1px solid #30343C;
        padding: 5px;
      }

      #order-no {
        color: #ADCBEB;
      }

      .chart-section,
      .order-section,
      .bucket-section {
        border-radius: var(--things-default-border-radius);
        overflow: hidden;
      }

      .order-section {
        display: grid;
        grid-template: 1fr 1fr / 1.1fr 1fr;
        background-color: #5a6378;
      }

      .bucket-section {
        background-color: #409c4b;
      }

      .order-section div {
        text-align: center;
        color: #fff;
      }

      .order-section div span {
        display: block;
      }

      .order-section img {
        display: block;
        margin: auto;
      }

      .order-section .order2 {
        padding-top: 0;
        grid-area: 2 / 1;
      }

      .order-section .order3 {
        border-left: 1px solid rgba(0, 0, 0, .3);
        border-bottom: 1px solid rgba(0, 0, 0, .3);
      }

      .order-section .order4 {
        border-left: 1px solid rgba(0, 0, 0, .3);
      }

      span.bigtitle {
        margin: 20px 0 15px 0;
        font-size: 0.9rem;
      }

      span.smalltitle {
        margin: 20px 0 7px 0;
        font-size: .9rem;
      }

      span.bigtitle,
      span.smalltitle {
        display: inline-block !important;
        border-bottom: 3px solid var(--things-secondary-color);
      }

      span.plan,
      span.proc {
        font-size: .7rem;
      }

      span.plan b,
      span.proc b {
        display: inline-block;
        margin-left: 9px;
        width: 85px;
        position: relative;
        top: 5px;
        font-size: 1.1rem;
        text-align: right;
      }

      .order-section .order2 b {
        top: 10px;
        font-size: 1.7rem;
      }

      span.plan {
        opacity: .6;
      }

      .bucket-section {
        text-align: center
      }

      span.bucket {
        display: block;
        margin-top: .4rem;
        color: #fff;
        font-size: 1.1rem;
      }

      span.bucket img {
        position: relative;
        top: 12px;
        width: 55px;
      }

      .bucket-section b {
        display: block;
        color: #fff;
        font-size: 5rem;
        text-shadow: 1px 3px 3px rgba(0, 0, 0, .3);
        line-height: 1.3;
      }

      #scene-board div {
        position: relative !important;
      }
    </style>

    <!-- 차트 Scene 모델 정보를 위한 Ajax -->
    <sys-ajax auto id="chart-scene-ajax" method="GET" content-type="plain/text" last-response="{{chartSceneData}}">
    </sys-ajax>

    <!-- 주문 정보 표시를 위한 Ajax -->
    <sys-ajax id="batch-summary-ajax" method="GET" content-type="application/json" last-response="{{orderDataSet}}">
    </sys-ajax>

    <!-- 공박스 투입을 위한 Ajax -->
    <sys-ajax id="input-ajax" curl="/kiosk_process/dps/input_bucket/:region_cd/:bucket_cd" method="PUT"
      content-type="application/json" last-response="{{orderDataSet}}" on-sys-ajax-error="_onBucketCdScanError">
    </sys-ajax>

    <div id="container">
      <div id="top-container">
        <!-- chart begin -->
        <!-- <div id="scene-board" class="chart-section"></div> -->
        <!-- chart end -->

        <!-- order status begin -->
        <!-- <div class="order-section">
          <div class="order1">
            <span class="bigtitle">[[orderLabel]]</span>
            <img src="./images/icon-dashboard.png">
          </div>
          <div class="order2">
            <span class="proc">[[pickedLabel]]<b>[[orderPicked]]</b></span>
            <span class="plan">[[pickingLabel]]<b>[[orderPicking]]</b></span>
          </div>
          <div class="order3">
            <span class="smalltitle">SKU</span>
            <span class="proc">[[pickedLabel]]<b>[[skuPicked]]</b></span>
            <span class="plan">[[pickingLabel]]<b>[[skuPicking]]</b></span>
          </div>
          <div class="order4">
            <span class="smalltitle">PCS</span>
            <span class="proc">[[pickedLabel]]<b>[[pcsPicked]]</b></span>
            <span class="plan">[[pickingLabel]]<b>[[pcsPicking]]</b></span>
          </div>
        </div> -->
        <div id="proc-rate-total" class="chart-section">
          <div class="chart-row">
            <span>[[totalProcRateLabel]]</span>
            <span class="col-header">[[pickedLabel]]</span>
            <span class="col-header">[[pickingLabel]]</span>
          </div>

          <div class="chart-row">
            <div class="bar-chart">
              <span class="label">[[orderLabel]]</span>
              <div class="bar">
                <span id="order-bar" class="chart-value"
                  style="width:calc([[totalProgressRate]]% - 10px)">[[totalProgressRate]]%</span>
              </div>
            </div>

            <span class="num-data">[[totalOrderPicked]]</span>
            <span class="num-data">[[totalOrderPicking]]</span>
          </div>

          <div class="chart-row">
            <div class="bar-chart">
              <span class="label">SKU</span>
              <div class="bar">
                <span id="sku-bar" class="chart-value"
                  style="width:calc([[totalProgressRateBySku]]% - 10px)">[[totalProgressRateBySku]]%</span>
              </div>
            </div>

            <span class="num-data">[[totalSkuPicked]]</span>
            <span class="num-data">[[totalSkuPicking]]</span>
          </div>

          <div class="chart-row">
            <div class="bar-chart">
              <span class="label">Total</span>
              <div class="bar">
                <span id="pcs-bar" class="chart-value"
                  style="width:calc([[totalGaugeRate]]% - 10px)">[[totalGaugeRate]]%</span>
              </div>
            </div>

            <span class="num-data">[[totalPcsPicked]]</span>
            <span class="num-data">[[totalPcsPicking]]</span>
          </div>
        </div>
        <!-- order status end -->

        <!-- bucket status begin -->
        <div class="bucket-section">
          <span class="bucket">
            <img src="./images/icon-greenbox.png">
            [[inputableBucketLabel]]
          </span>
          <b>[[inputableBuckets]]</b>
        </div>
        <!-- bucket status end -->
      </div>

      <div id="middle-container">
        <span id="label">
          <img src="./images/icon-barcode.png" />
          [[bucketScanLabel]]
        </span>

        <input id="input-bucket-cd" on-keypress="_onBucketCdScan">

        <button id="refresh-btn" on-click="refresh">
          <img src="./images/icon-refresh.png" />
          <span>[[refreshLabel]]</span>
        </button>
      </div>

      <item-list id="item-list" header="[[header]]" page="[[page]]" total="[[total]]" limit="[[limit]]" data="[[items]]"
        show-paginator on-data-list-click="showOrderItems" on-paginator-changed="_pageChanged">
      </item-list>
    </div>
  </template>

  <script>
    class B2CBoxInput extends Polymer.Element {
      static get is() { return 'b2c-box-input' }

      static get properties() {
        return {
          /**
           * 버킷 스캔 라벨
           ****************
           * @type {String}
           */
          bucketScanLabel: {
            type: String,
            value: function () {
              return t('label.bucket_cd');
            }
          },

          /**
           * 새로고침 라벨
           ****************
           * @type {String}
           */
          refreshLabel: {
            type: String,
            value: function () {
              return t('button.refresh');
            }
          },

          /**
           * 투입 가능 버킷 수 라벨
           ****************
           * @type {String}
           */
          inputableBucketLabel: {
            type: String,
            value: function () {
              return t('label.inputable_buckets');
            }
          },

          /**
           * 주문 라벨
           ****************
           * @type {String}
           */
          orderLabel: {
            type: String,
            value: function () {
              return t('label.order');
            }
          },

          /**
           * 총 진행율 라벨
           ****************
           * @type {String}
           */
          totalProcRateLabel: {
            type: String,
            value: () => t('label.total_proc_rate')
          },

          /**
           * 확정 라벨
           ****************
           * @type {String}
           */
          pickedLabel: {
            type: String,
            value: function () {
              return t('label.picked_qty');
            }
          },

          /**
           * 예정 라벨
           ****************
           * @type {String}
           */
          pickingLabel: {
            type: String,
            value: function () {
              return t('label.pick_qty');
            }
          },

          /**
           * 주문 확정
           ****************
           * @type {Number}
           */
          orderPicked: {
            type: Number,
            value: 0
          },

          /**
           * 주문 예정
           ****************
           * @type {Number}
           */
          orderPicking: {
            type: Number,
            value: 0
          },

          /**
           * SKU 확정
           ****************
           * @type {Number}
           */
          skuPicked: {
            type: Number,
            value: 0
          },

          /**
           * SKU 예정
           ****************
           * @type {Number}
           */
          skuPicking: {
            type: Number,
            value: 0
          },

          /**
           * PCS 확정
           ****************
           * @type {Number}
           */
          pcsPicked: {
            type: Number,
            value: 0
          },

          /**
           * PCS 예정
           ****************
           * @type {Number}
           */
          pcsPicking: {
            type: Number,
            value: 0
          },

          /**
 * 토탈 주문 확정
 ****************
 * @type {Number}
 */
          totalOrderPicked: {
            type: Number,
            value: 0
          },

          /**
           * 주문 예정
           ****************
           * @type {Number}
           */
          totalOrderPicking: {
            type: Number,
            value: 0
          },

          /**
           * SKU 확정
           ****************
           * @type {Number}
           */
          totalSkuPicked: {
            type: Number,
            value: 0
          },

          /**
           * SKU 예정
           ****************
           * @type {Number}
           */
          totalSkuPicking: {
            type: Number,
            value: 0
          },

          /**
           * PCS 확정
           ****************
           * @type {Number}
           */
          totalPcsPicked: {
            type: Number,
            value: 0
          },

          /**
           * PCS 예정
           ****************
           * @type {Number}
           */
          totalPcsPicking: {
            type: Number,
            value: 0
          },

          /**
           * 작업 진행율 (주문)
           ****************
           * @type {Number}
           */
          progressRate: {
            type: Number,
            value: 0
          },

          /**
           * 작업 진행율 (PCS)
           ****************
           * @type {Number}
           */
          gaugeRate: {
            type: Number,
            value: 0
          },

          /**
           * 투입가능 버킷수
           ****************
           * @type {Number}
           */
          inputableBuckets: {
            type: Number,
            value: 0
          },

          /**
           * 차트 데이터
           ****************
           * @type {Object}
           */
          chartSceneData: {
            type: Object,
            observer: '_chartSceneDataChanged'
          },

          /**
           * 주문 데이터 셋
           ****************
           * @type {Object}
           */
          orderDataSet: {
            type: Object,
            observer: '_orderDataSetChanged'
          },

          /**
           * 자동 리프레쉬 활성화
           ****************
           * @type {Boolean}
           */
          enableAutoRefresh: {
            type: Boolean
          },

          /**
           * 페이지 정보
           ****************
           * @type {Number}
           */
          page: {
            type: Number,
            value: 1
          },

          /**
           * Limit 정보
           ****************
           * @type {Number}
           */
          limit: {
            type: Number,
            value: 100
          },

          /**
           * 총 아이템 개수
           ****************
           * @type {Number}
           */
          total: {
            type: Number
          },

          /**
           * 그리드 데이터
           ****************
           * @type {Object}
           */
          items: {
            type: Array,
            observer: '_itemsChanged'
          },

          /**
           * 그리드 헤더 정보
           ****************
           * @type {Array}
           */
          header: {
            type: Array,
            value: function () {
              return [{
                display: t('label.input_seq'),
                fieldname: 'input_seq',
                columnWidth: '0.75fr',
                style: {
                  color: '#fff'
                }
              }, {
                display: t('label.order_id'),
                fieldname: 'order_id',
                columnWidth: '2fr'
              }, {
                display: t('label.bucket_cd'),
                fieldname: 'bucket_cd',
                classCallback: (data) => {
                  let boxColor = data['mpi_color'];
                  boxColor = boxColor ? boxColor.toLowerCase() : 'n';

                  if (boxColor === 'r') {
                    return 'red';
                  } else if (boxColor === 'g') {
                    return 'green';
                  } else if (boxColor === 'b') {
                    return 'blue';
                  } else if (boxColor === 'y') {
                    return 'yellow'
                  } else {
                    return 'gray';
                  }
                }
              }, {
                display: t('label.size'),
                fieldname: 'box_type_cd',
                style: {
                  textAlign: 'center'
                },
                displayCallback: (data) => {
                  return data ? data : '';
                }
              }, {
                display: t('label.sku_qty') + ' (SKU)',
                fieldname: 'item_count',
                style: {
                  textAlign: 'right'
                }
              }, {
                display: t('label.picked_qty') + ' (PCS)',
                fieldname: 'picked_qty',
                style: {
                  textAlign: 'right'
                }
              }, {
                display: t('label.picking_qty') + ' (PCS)',
                fieldname: 'pick_qty',
                style: {
                  textAlign: 'right'
                }
              }, {
                display: t('label.status'),
                fieldname: 'status',
                style: {
                  textAlign: 'right'
                }
              }, {
                fieldname: 'mpi_color',
                hidden: true
              }]
            }
          },

          /**
           * 그리드 필드 정보
           ****************
           * @type {Array}
           */
          detailListFields: {
            type: Array,
            value: () => [{
              display: t('label.sku_nm'),
              fieldname: 'sku_nm',
              columnWidth: '1.2fr',
            }, {
              display: t('label.location'),
              fieldname: 'loc_cd',
              columnWidth: '1fr',
              style: {
                textAlign: 'center'
              }
            }, {
              display: t('label.picked_qty'),
              fieldname: 'picked_qty',
              columnWidth: '.2fr',
              style: {
                textAlign: 'right'
              }
            }, {
              display: t('label.picking_qty'),
              fieldname: 'pick_qty',
              columnWidth: '.2fr',
              style: {
                textAlign: 'right'
              }
            }, {
              display: t('label.status'),
              fieldname: 'status',
              columnWidth: '.3fr',
              style: {
                textAlign: 'center'
              }
            }]
          }
        }
      }

      /**
       * ready
       *******************
       */
      connectedCallback() {
        super.connectedCallback();

        // 1. Scene 가져오기
        var chartAjax = this.$['chart-scene-ajax'];
        chartAjax.curl = location.origin + '/scripts/fragments/mps/kiosk/json/job-progress-chart.json';

        // 2. 페이지 변경 이벤트 핸들러
        document.addEventListener('page-changed', (e) => {
          this._routingChanged(e);
        });

        // 3. 페이지 리프레쉬
        this.enableAutoRefresh = true;
        this.startAutoRefresh();
      }

      /**
       * 페이지 변경 시
       *******************
       * @param {Object} e
       */
      _routingChanged(e) {
        if (e.detail.currentPage == 'b2c_box_input') {
          this._initialSetup();
          this.enableAutoRefresh = true;
        } else {
          this.enableAutoRefresh = false;
        }
      }

      /**
       * 초기 셋업
       *******************
       */
      _initialSetup() {
        this.$['input-bucket-cd'].select();
      }

      /**
       * 자동 리프레쉬 시작
       *******************
       */
      startAutoRefresh() {
        if (this.enableAutoRefresh) {
          try {
            this.refresh();
          } catch (e) {
          }
        }

        let interval = 20 * 1000;
        try {
          interval = LOGIS_UTIL.getRefreshInterval();
        } catch (e) {
        }

        setTimeout(function () {
          this.startAutoRefresh();
        }.bind(this), interval);
      }

      /**
       * 데이터 변경 시
       *******************
       * @param {Array} items
       */
      _itemsChanged(items) {
        this._barcodeInputReset();
      }

      /**
       * 바코드 인풋 박스 리셋
       *******************
       */
      _barcodeInputReset() {
        var inputBucketCd = this.$['input-bucket-cd'];
        if (this._scannedFlag) {
          inputBucketCd.value = '';
          this._scannedFlag = false;
        }
        inputBucketCd.focus();
      }

      /**
       * 차트 Scene 데이터 변경시
       ***********************
       * @param {Object} chartSceneData
       */
      _chartSceneDataChanged(chartSceneData) {
        // 1. Scene 모델 설정
        this.sceneModel = chartSceneData;
        // 2. Scene License 주입
        scene.license(ThingsLicense);
        // 3. Scene 생성
        var sceneViewer = this.$['scene-board'];
        this.chartScene = scene.create({
          target: sceneViewer,
          model: this.sceneModel
        });
        // 4. Scene 화면 Fit
        this.chartScene.fit('both');
        // 5. 데이터 바인딩
        this.chartScene.data = { progressRate: 0, gaugeRate: 0 };
      }

      /**
       * 주문 데이터 셋
       * 주문 데이터가 정상적으로 조회되면 자동조회를 활성화 하기 위해 enableAutoRefresh flag를 true로 초기화
       **************
       * @param {Object} orderDataSet
       */
      _orderDataSetChanged(orderDataSet) {
        if (orderDataSet) this.enableAutoRefresh = true;

        if (orderDataSet) {
          this.total = orderDataSet.total;
          this.inputableBuckets = orderDataSet.inputable_buckets;
          this.orderPicking = orderDataSet.order_picking_qty;
          this.orderPicked = orderDataSet.order_picked_qty;
          this.skuPicking = orderDataSet.sku_picking_qty;
          this.skuPicked = orderDataSet.sku_picked_qty;
          this.pcsPicking = orderDataSet.pcs_picking_qty;
          this.pcsPicked = orderDataSet.pcs_picked_qty;
          this.progressRate = (!this.orderPicking || this.orderPicking == 0 || !this.orderPicked || this.orderPicked == 0) ? 0 : ((this.orderPicked / this.orderPicking) * 100).toFixed(1);
          this.gaugeRate = (!this.pcsPicking || this.pcsPicking == 0 || !this.pcsPicked || this.pcsPicked == 0) ? 0 : ((this.pcsPicked / this.pcsPicking) * 100).toFixed(1);

          this.chartScene.data = {
            progressRate: this.progressRate,
            gaugeRate: this.gaugeRate
          };

          this.items = orderDataSet.items ? orderDataSet.items : [];

          this.totalOrderPicking = orderDataSet.tot_order_picking_qty;
          this.totalOrderPicked = orderDataSet.tot_order_picked_qty;
          this.totalSkuPicking = orderDataSet.tot_sku_picking_qty;
          this.totalSkuPicked = orderDataSet.tot_sku_picked_qty;
          this.totalPcsPicking = orderDataSet.tot_pcs_picking_qty;
          this.totalPcsPicked = orderDataSet.tot_pcs_picked_qty;

          this.totalProgressRate = Number((!this.totalOrderPicking || this.totalOrderPicking == 0 || !this.totalOrderPicked || this.totalOrderPicked == 0) ? 0 : ((this.totalOrderPicked / this.totalOrderPicking) * 100).toFixed(1));
          this.totalProgressRateBySku = Number((!this.totalSkuPicking || this.totalSkuPicking == 0 || !this.totalSkuPicked || this.totalSkuPicked == 0) ? 0 : ((this.totalSkuPicked / this.totalSkuPicking) * 100).toFixed(1));
          this.totalGaugeRate = Number((!this.totalPcsPicking || this.totalPcsPicking == 0 || !this.totalPcsPicked || this.totalPcsPicked == 0) ? 0 : ((this.totalPcsPicked / this.totalPcsPicking) * 100).toFixed(1));
        }
      }

      /**
       * 버킷 스캔값 변경 핸들러
       *********************
       * @param {Object} event
       */
      _onBucketCdScan(event) {
        if (event.key === 'Enter') {
          var boxCd = event.currentTarget.value;

          if (/^[bcdfghiBCDFGHI][0-9]{7}$/.exec(boxCd)) {
            event.currentTarget.value = '';

            if (LOGIS_UTIL.getKioskInputType() === 'box') {
              this.inputBox(boxCd);
            } else {
              this.inputBucket(boxCd);
            }

            SOUND.playInfoSound();
            this._scannedFlag = true;

          } else {
            document.dispatchEvent(new CustomEvent('show-toast', {
              detail: {
                type: t('text.box_form_check'),
                message: t('text.box_form_check')
              }
            }));
          }
        }
      }

      /**
       * 새로고침 - 주문 조회
       *******************
       * @param {Object} event
       */
      refresh(event) {
        this._barcodeInputReset();
        var regionCd = LOGIS_UTIL.getRegionCd();

        if (regionCd) {
          var showOrderAjax = this.$['batch-summary-ajax'];
          var url = '/kiosk_process/dps/batch_summary/' + regionCd;
          url = url + '?page=' + this.page + '&limit=' + this.limit;
          showOrderAjax.curl = url;
          showOrderAjax.generateRequest();
        } else {
          LOGIS_UTIL.showMessage(t('title.selecting_region'), t('text.select_region'));
        }
      }

      /**
       * item-list paginator-changed event handler
       * item-list의 page, limit, total property가 변경 되면 호출 됨
       * event.detail을 통해 현재 리스트의 page, limit을 초기화 하고
       ***********************
       * @param {Object} event
       */
      _pageChanged(event) {
        this.page = event.detail.page;
        this.limit = event.detail.limit;
      }

      /**
       * 웹 소켓으로 부터 데이터를 받아서 리프레쉬
       * 자동 조회 활성화를 위해 enableAutoRefresh flag를 true로 초기화
       *******************
       * @param {Object} data
       */
      refreshByWs(data) {
        this.enableAutoRefresh = true;
        this.orderDataSet = data;
      }

      /**
       * 버킷 투입 트랜잭션
       ******************
       * @param {String} bucketCd
       */
      inputBucket(bucketCd) {
        if (bucketCd && bucketCd.length >= 4) {
          var regionCd = LOGIS_UTIL.getRegionCd();

          if (regionCd) {
            var inputBucketAjax = this.$['input-ajax'];
            var url = '/kiosk_process/dps/input_bucket/' + regionCd + '/' + bucketCd;
            url = url + '?page=' + this.page + '&limit=' + this.limit;
            inputBucketAjax.curl = url;
            inputBucketAjax.generateRequest();
          } else {
            LOGIS_UTIL.showMessage(t('title.selecting_region'), t('text.select_region'));
          }
        }
      }

      /**
       * 박스 투입 트랜잭션
       ******************
       * @param {String} boxId
       */
      inputBox(boxId) {
        if (boxId && boxId.length >= 4) {
          var regionCd = LOGIS_UTIL.getRegionCd();

          if (regionCd) {
            // 박스 ID의 첫 번째 글자가 박스 타입
            var boxType = boxId.substring(0, 1);
            var inputBucketAjax = this.$['input-ajax'];
            var url = '/kiosk_process/dps/input_box/' + regionCd + '/' + boxId + '/' + boxType;
            url = url + '?page=' + this.page + '&limit=' + this.limit;
            inputBucketAjax.curl = url;
            inputBucketAjax.generateRequest();
          } else {
            LOGIS_UTIL.showMessage(t('title.selecting_region'), t('text.select_region'));
          }
        }
      }

      /**
       * 버킷 코드 스캔 에러시
       * 자동 리프레쉬 되지 않도록 enableAutoRefresh flag를 false로 초기화
       *******************
       * @param {Object} e
       */
      _onBucketCdScanError(e) {
        // LOGIS_UTIL.showMessage(e.detail.code, e.detail.msg, () => {
        //   this._initialSetup();
        // });
        this.enableAutoRefresh = false;
      }

      /**
       * 주문 상세 정보 조회
       ******************
       * @param {Object} event
       */
      showOrderItems(event) {
        const data = event.detail.data;

        document.dispatchEvent(new CustomEvent('open-form-list-dialog', {
          detail: {
            title: '[' + data.order_id + '] ' + t('title.dps_order_info_detail'),
            listFields: this.detailListFields,
            listDataReqUrl: `/kiosk_process/dps/${data.order_id}/order_items`,
            handleListDataAfterSet: params => {
              const rows = params.listElement.getRows();
              rows.forEach(row => {
                const rowData = row.getData();
                if (parseInt(rowData.pick_qty) === parseInt(rowData.picked_qty)) {
                  row.classList.add('complete');
                }
              })
            },
            closeCallback: this._initialSetup.bind(this)
          }
        }));
      }
    }

    customElements.define(B2CBoxInput.is, B2CBoxInput);
  </script>
</dom-module>