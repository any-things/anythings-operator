<!--
@license
Copyright © HatioLab Inc. All rights reserved.
-->

<script>
  LogisSettingMixin = superClass => {
    return class LogisSettingMixin extends superClass {
      static get properties() {
        return {
          /**
           * @description 랙 라벨
           ****************
           * @type {String}
           */
          rackLabel: {
            type: String,
            value: () => t('label.rack_nm')
          },

          /**
           * @description 작업 라벨
           ****************
           * @type {String}
           */
          jobLabel: {
            type: String,
            value: () => t('label.job_type')
          },

          /**
           * @description 스테이션 라벨
           ****************
           * @type {String}
           */
          zoneLabel: {
            type: String,
            value: () => t('label.zone_cd')
          },

          /**
           * @description 작업 위치 라벨
           ****************
           * @type {String}
           */
          rackSideLabel: {
            type: String,
            value: () => t('label.rack_side')
          },

          /**
           * @description 왼쪽 라벨
           ****************
           * @type {String}
           */
          leftLabel: {
            type: String,
            value: () => t('label.left')
          },

          /**
           * @description 오른쪽 라벨
           ****************
           * @type {String}
           */
          rightLabel: {
            type: String,
            value: () => t('label.right')
          },

          /**
           * @description 앞쪽 라벨
           ****************
           * @type {String}
           */
          frontLabel: {
            type: String,
            value: () => t('label.front')
          },

          /**
           * @description 뒤쪽 라벨
           ****************
           * @type {String}
           */
          rearLabel: {
            type: String,
            value: () => t('label.rear')
          },

          /**
           * @description All 라벨
           ****************
           * @type {String}
           */
          allLabel: {
            type: String,
            value: () => t('label.all')
          },

          /**
           * @description 랙 코드
           ****************
           * @type {String}
           */
          rackCode: {
            type: String,
            value: () => JSON.parse(localStorage.getItem('setting.rackCd'))
          },

          /**
           * @description 랙 코드 로케일 키
           ****************
           * @type {String}
           */
          rackCodeLSKey: {
            type: String,
            value: 'setting.rackCd'
          },

          /**
           * @description 랙 이름
           ****************
           * @type {String}
           */
          rackName: {
            type: String
          },

          /**
           * @description 랙 이름 로케일 키
           ****************
           * @type {String}
           */
          rackNameLSKey: {
            type: String,
            value: 'setting.rackNm'
          },

          /**
           * @description 스테이션 코드
           ****************
           * @type {String}
           */
          zoneCode: {
            type: String,
            value: () => JSON.parse(localStorage.getItem('setting.equipZone'))
          },

          /**
           * @description 스테이션 라벨 로케일 키
           ****************
           * @type {String}
           */
          zoneCodeLSKey: {
            type: String,
            value: 'setting.equipZone'
          },

          /**
           * @description 작업 유형
           ****************
           * @type {String}
           */
          jobType: {
            type: String,
            value: () => JSON.parse(localStorage.getItem('setting.jobType'))
          },

          /**
           * @description 작업 이름 로케일 키
           ****************
           * @type {String}
           */
          jobTypeLSKey: {
            type: String,
            value: 'setting.jobType'
          },

          /**
           * @description 작업 위치
           ****************
           * @type {String}
           */
          rackSide: {
            type: String,
            //value: () => JSON.parse(localStorage.getItem('setting.rackSide'))
            value: () => 'ALL'
          },

          /**
           * @description 작업 위치 로케일 키
           ****************
           * @type {String}
           */
          rackSideLSKey: {
            type: String,
            value: 'setting.rackSide'
          },

          /**
           * @description 작업 위치 명
           ****************
           * @type {String}
           */
          rackSideName: {
            type: String
          },

          /**
           * @description 작업 위치 명 로케일 키
           ****************
           * @type {String}
           */
          rackSideNameLSKey: {
            type: String,
            value: 'setting.rackSideLabel'
          }
        }
      }

      /**
       * @description broker address를 조회
       *******************************
       * @return
       */
      _getBrokerAddress() {
        let brokerAddrsAjax = this._getBrokerAddrsAjax();
        brokerAddrsAjax.curl = '/settings/show_by_name?name=mps.broker.address';
        brokerAddrsAjax.baseUrl = this._getLocalStorage('setting.baseUrl');
        brokerAddrsAjax.generateRequest();
      }

      /**
       * @description broker port를 조회
       *******************************
       * @return
       */
      _getBrokerPort() {
        let brokerPortAjax = this._getBrokerPortAjax();
        brokerPortAjax.curl = '/settings/show_by_name?name=mps.broker.port';
        brokerPortAjax.baseUrl = this._getLocalStorage('setting.baseUrl');
        brokerPortAjax.generateRequest();
      }

      /**
       * @description broker site를 조회
       *******************************
       * @return
       */
      _getBrokerSite() {
        let brokerSiteAjax = this._getBrokerSiteAjax();
        brokerSiteAjax.curl = '/settings/show_by_name?name=mps.broker.site.code';
        brokerSiteAjax.baseUrl = this._getLocalStorage('setting.baseUrl');
        brokerSiteAjax.generateRequest();
      }

      /**
       * @description return broker-addrs-ajax
       *******************************
       * @return
       */
      _getBrokerAddrsAjax() {
        return this.$['broker-addrs-ajax'];
      }

      /**
       * @description return broker-port-ajax
       *******************************
       * @return
       */
      _getBrokerPortAjax() {
        return this.$['broker-port-ajax'];
      }

      /**
       * @description return broker-site-ajax
       *******************************
       * @return
       */
      _getBrokerSiteAjax() {
        return this.$['broker-site-ajax'];
      }

      /**
       * @description 조회한 broker address를 localStorage에 저장함
       *******************************
       */
      _setBrokerAddress(response) {
        if (response && response.detail) {
          localStorage.setItem('setting.brokerAddress', response.detail.value);
        }
      }

      /**
       * @description 조회한 broker port를 localStorage에 저장함
       *******************************
       */
      _setBrokerPort(response) {
        if (response && response.detail) {
          localStorage.setItem('setting.brokerPort', response.detail.value);
        }
      }

      /**
       * @description 조회한 broker site를 localStorage에 저장함
       *******************************
       */
      _setBrokerSite(response) {
        if (response && response.detail) {
          localStorage.setItem('setting.brokerSite', response.detail.value);
        }
      }

      /**
       * @description 랙 리스트를 조회
       *******************************
       * @return
       */
      _getRegionItems() {
        const rackItemAjax = this._getRackItemAjax();
        rackItemAjax.curl = `/racks?limit=1000`;
        rackItemAjax.baseUrl = this._getLocalStorage('setting.baseUrl');
        rackItemAjax.generateRequest();
      }

      /**
       * @description 스테이션 리스트를 조회
       *******************************
       * @return
       */
      _getZoneItems() {
        const selectedOption = this._getRackCombo().selectedOptions[0];
        if (selectedOption && selectedOption.value) {
          const rackCode = selectedOption.value;
          const zoneItemAjax = this._getZoneItemAjax();
          zoneItemAjax.curl = `/racks/${rackCode}/stations`;
          zoneItemAjax.baseUrl = this._getLocalStorage('setting.baseUrl');
          zoneItemAjax.generateRequest();
        }
      }

      /**
       * @description 작업 유형 리스트 조회
       *******************************
       * @return
       */
      _getJobItems() {
        const jobItemAjax = this._getJobItemAjax();
        jobItemAjax.curl = `/common_codes/show_by_name?name=JOB_TYPE`;
        jobItemAjax.baseUrl = this._getLocalStorage('setting.baseUrl');
        jobItemAjax.generateRequest();
      }

      /**
       * @description 설비 유형 리스트 조회
       *******************************
       * @return
       */
      _getEquipmentItems() {
        const equipmentItemAjax = this._getEquipmentItemAjax();
        equipmentItemAjax.curl = `/common_codes/show_by_name?name=EQUIP_TYPE`;
        equipmentItemAjax.baseUrl = this._getLocalStorage('setting.baseUrl');
        equipmentItemAjax.generateRequest();
      }

      /**
       * @description 콤보 클리어
       *******************************
       */
      _clearCombo(combo) {
        while (combo.childElementCount) {
          combo.removeChild(combo.firstElementChild);
        }
      }

      /**
       * @description key로 로컬 스토리지에서 뽑아냄
       *******************************
       * @return
       */
      _getLocalStorage(key) {
        return JSON.parse(localStorage.getItem(key));
      }

      /**
       * @description 로컬 스토리지에서 key, value로 저장
       *******************************
       */
      _setLocalStorage(key, value) {
        localStorage.setItem(key, JSON.stringify(value));
      }

      /**
       * @description 체크한 옵션 값 리턴
       *******************************
       * @return
       */
      _getSelectedOpt(options) {
        return options.filter(option => {
          return option.checked
        })[0];
      }

      /**
       * @description 랙 리스트 조회 Ajax
       *******************************
       */
      _getRackItemAjax() {
        return this.$['rack-items-ajax'];
      }

      /**
       * @description 작업 유형 리스트 Ajax
       *******************************
       */
      _getJobItemAjax() {
        return this.$['job-combo-ajax'];
      }

      /**
       * @description 설비 유형 리스트 Ajax
       *******************************
       */
      _getEquipmentItemAjax() {
        return this.$['equipment-items-ajax'];
      }

      /**
       * @description 스테이션 리스트 Ajax
       *******************************
       * @return
       */
      _getZoneItemAjax() {
        return this.$['zone-items-ajax'];
      }

      /**
       * @description 업데이트 세팅 ajax 리턴
       *******************************
       * @return
       */
      _getUpdateSettingAjax() {
        return this.$['update-setting-ajax'];
      }

      /**
       * @description 유형 리스트 콤보 리턴
       *******************************
       * @return
       */
      _getRackCombo() {
        return this.$['rack-combo'];
      }

      /**
       * @description 스테이션 리스트 콤보 리턴
       *******************************
       */
      _getZoneCombo() {
        return this.$['zone-combo'];
      }

      /**
       * @description 설비 유형 리스트 콤보 리턴
       *******************************
       */
      _getEquipmentCombo() {
        return this.$['equipment-combo'];
      }

      /**
       * @description 작업 유형 리스트 콤보 리턴
       *******************************
       * @return
       */
      _getJobCombo() {
        return this.$['job-combo'];
      }

      /**
       * @description 작업 위치 (사이드 코드) 값 리턴
       *******************************
       * @return
       */
      _getRackSideOpts() {
        //return Array.from(this.$['rack-side'].querySelectorAll('input[name=rack-side]'));
        return ['ALL'];
      }

      /**
       * @description 작업 위치 (사이드 코드) 콤보 렌더링
       *******************************
       */
      _setRackSideDefaultValue() {
        /*const rackSideOpts = this._getRackSideOpts();
        rackSideOpts.forEach(rackSideOpt => {
          if (this.rackSide === rackSideOpt.value) {
            rackSideOpt.checked = true;
          }
        });*/

        this.rackSide = 'ALL';
      }

      /**
       * @description 랙 콤보 렌더링
       *******************************
       */
      _renderRegionCombo(event) {
        const rackCombo = this._getRackCombo();
        this._clearCombo(rackCombo);

        if (event && event.detail) {
          event.detail.items.forEach(rack => {
            const option = new Option(rack.rack_nm, rack.rack_cd);
            if (this.rackCode === rack.rack_cd) {
              option.selected = true;
              this.rackName = rack.rack_nm;
            }

            rackCombo.appendChild(option);
          });
        }

        if (this.deviceType !== 'KIOSK') {
          this._getZoneItems();
        }

        this._getZoneItems();
      }

      /**
       * @description 작업 스테이션 콤보 렌더링
       *******************************
       */
      _renderZoneCombo(event) {
        const zoneCombo = this._getZoneCombo();
        this._clearCombo(zoneCombo);

        if (event && event.detail) {
          event.detail.forEach(zone => {
            const option = new Option(zone, zone);
            if (this.zoneCode === zone) {
              option.selected = true;
            }

            zoneCombo.appendChild(option);
          })
        }
      }

      /**
       * @description 설비 유형 콤보 렌더링
       *******************************
       * @param {Object} event
       */
      _renderEquipmentCombo(event) {
        const equipmentCombo = this._getEquipmentCombo();
        this._clearCombo(equipmentCombo);
        console.log(equipmentCombo);
        event.detail.items.forEach(equipment => {
          const option = new Option(equipment.description, equipment.name);
          if (this.equipmentType === equipment.name) {
            option.selected = true;
            this.equipmentType = equipment.name;
          }

          equipmentCombo.appendChild(option);
        })
      }

      /**
       * @description 작업 유형 콤보 렌더링
       *******************************
       * @param {Object} event
       */
      _renderJobCombo(event) {
        const jobCombo = this._getJobCombo();
        this._clearCombo(jobCombo);

        event.detail.items.forEach(job => {
          const option = new Option(job.description, job.name);
          if (this.jobType === job.name) {
            option.selected = true;
            this.jobType = job.name;
          }

          jobCombo.appendChild(option);
        })
      }
    }
  }
</script>