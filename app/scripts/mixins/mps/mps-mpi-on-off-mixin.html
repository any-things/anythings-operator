<!--
@license
Copyright © HatioLab Inc. All rights reserved.
-->

<!--
  Operato에서 표시기 On / Off 기능을 사용하는 화면의 공통 기능 Mixin
  1. 설정한 호기에 내려진 작업 배치의 작업 리스트 중에서 작업이 시작된 표시기 점등 (이전 작업 상태 복원)
  2. 설정한 호기의 모든 표시기 Off
  를 수행함
-->

<script>
  MpsOnOffMixin = superClass => {
    return class MpsOnOffMixin extends superClass {
      constructor(...args) {
        super(...args);
        this.mpiOnAjax = (() => {
          var ajax = document.createElement('sys-ajax');
          ajax.id = 'mpi-on-ajax';
          ajax.method = 'PUT';
          ajax.contentType = 'application/json';
          return ajax;
        })();
        this.mpiOffAjax = (() => {
          var ajax = document.createElement('sys-ajax');
          ajax.id = 'mpi-off-ajax';
          ajax.method = 'PUT';
          ajax.contentType = 'application/json';
          return ajax;
        })();
        // 요소가 문서에 실존하지 않으면 요소 내부 콜백 등이 동작하지 않음으로 인함
        this.appendChild(this.mpiOnAjax);
        this.appendChild(this.mpiOffAjax);
      }

      /**
       * @description 버튼 표시 팝업 버튼을 클릭시
       *******************
       * @param {String} buttonId
       */
      _popupButtonClick(buttonId) {
        switch (buttonId) {
          case 'mpi-on':
            this._mpiOnRequest();
            break;
          case 'mpi-off':
            this._mpiOffRequest();
            break;
        }
      }

      /**
       * @description MPI 점등 Ajax 생성 후 리턴
       */
      _getMpiOnAjax() {
        return this.mpiOnAjax;
      }

      /**
       * @description MPI 소등 Ajax 생성 후 리턴
       */
      _getMpiOffAjax() {
        return this.mpiOffAjax;
      }

      /**
       * @description MPI 점등
       */
      _mpiOnRequest() {
        openConfirm({
          title: t('button.led_on'),
          message: t('text.Sure to process'),
          confirmCallback: () => {
            const regionCd = ANY_UTIL.getRegionCd();
            const mpiOnAjax = this._getMpiOnAjax();
            mpiOnAjax.curl = `/kiosk_process/restore_mpi/${regionCd}`;
            mpiOnAjax.generateRequest();
          },
          cancelCallback: () => {}
        });
      }

      /**
       * @description MPI 소등
       */
      _mpiOffRequest() {
        openConfirm({
          title: t('button.led_off'),
          message: t('text.Sure to process'),
          confirmCallback: () => {
            const regionCd = ANY_UTIL.getRegionCd();
            const mpiOffAjax = this._getMpiOffAjax();
            mpiOffAjax.curl = `/kiosk_process/mpi_off_all/${regionCd}`;
            mpiOffAjax.generateRequest();
          },
          cancelCallback: () => {}
        });
      }
    };
  };
</script>
